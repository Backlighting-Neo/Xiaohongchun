$(document).ready(function(){var t="",e="",a="http://localhost:1337",n=$("#v"),o=$("#editzone"),l=$("#umeditor"),i=$("#event_name");$.get("test6.html").then(function(t){n.html(t)}).then(function(){$.getJSON(a).then(function(t){e=t.token})}).then(function(){var t="";for(item in data){var e={text:'<div class="form-group"><label for="{item}">{cname}</label><input type="{type}" v-model="{model}" class="form-control" value="{value}" /></div>',html:'<div class="form-group"><label for="{item}">{cname}</label><button type="button" class="btn btn-default html_edit_button" data-item="{item}">点击编辑</button><input type="text" v-model="{model}" class="form-control nodisplay" value="{value}" /><span class="brief">{brief}</span></div>',image:'<div class="form-group"><label for="{item}">{cname}</label><input type="text" v-model="{model}" class="form-control" value="{value}" /></div><div class="form-group"><div class="col-md-8"><input type="file" class="form-control" id="uploader_{item}" accept="image/*"/></div><div class="col-md-4"><button type="button" class="btn btn-primary upload_image_button" data-item="{item}">上传图片</button></div><div class="clearfix"></div></div>',video:'<div class="form-group"><label for="{item}">{cname}</label><div class="clearfix"></div><div class="col-md-8"><input type="text" v-model="{model}" class="form-control" value="{value}" id="video_{item}"/></div><div class="col-md-4"><button type="button" data-item="{item}" class="btn btn-primary video_change_button">确定</button></div><div class="clearfix"></div></div>'}[data[item].type];t=t.concat(e.replace(/{item}/g,item).replace("{cname}",data[item].cname).replace("{type}",data[item].type).replace("{value}","{{"+item+".value}}").replace("{model}",item+".value").replace("{brief}","( {{"+item+".value.replace(/<.*?>/,'').substring(0,10)}} )"))}o.append(t)}).then(function(){$(".html_edit_button").click(function(){o.hide(),l.show();var e=$(this).attr("data-item");d.setContent(data[e].value),t=e}),$("#html_edit_ok").click(function(){o.show(),l.hide(),data[t].value=d.getContent()}),$(".upload_image_button").click(function(){var t=$(this).attr("data-item"),a=document.getElementById("uploader_"+t).files.item(0);if(a){var n=new FormData,o="event/image/"+t+"_"+Date.parse(new Date);n.append("file",a),n.append("token",e),n.append("key",o),$.ajax({url:"http://upload.qiniu.com",type:"POST",data:n,cache:!1,contentType:!1,processData:!1}).then(function(e){data[t].value="http://static.xiaohongchun.com/"+o})}else alert("还没有选择图片哦亲")}),$(".video_change_button").click(function(){var t=$(this).attr("data-item");$.ajax({url:"http://www.xiaohongchun.com/api2/video/get_video_info",type:"POST",data:{vid:$("#video_"+t).val()}}).then(function(e){e=$.parseJSON(e);var a=e.data.cover_url,n=e.data.full_path;data[t].video=n,data[t].poster=a,console.log("1"),window.document.getElementsByTagName("video")[0].load(),console.log("2")})})}).then(function(){new Vue({el:"#v",data:data}),new Vue({el:"#e",data:data})});var c=function(t,e){var a=document.createElement("a"),n=new Blob([e]),o=document.createEvent("HTMLEvents");o.initEvent("click",!1,!1),a.download=t,a.href=URL.createObjectURL(n),a.dispatchEvent(o)};$("#generateH5").click(function(){var t=n.html(),e=i.val();if(e){t=t.replace(/<script>(.|\n)*?<\/script>/g,"");var a='<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=750"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="format-detection" content="telephone=no"><meta name="description" content="小红唇是小白学化妆神器，让你10秒学会化妆，最快速度找到适合你的化妆品"><title>'+e+"</title></head><body>"+t+"</body></html>";c(e+".html",a)}else alert("还没有填活动名称哦亲")});var d=UM.getEditor("Editor")});
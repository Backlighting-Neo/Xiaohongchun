!function(){function a(){return $(".viewport").height($(window).height()-$(".header").height()).css("opacity",1),a}$(window).on("resize",a(!0));var e=["help","about","account"];switch($.each(e,function(a,t){$("div.header").on("click","a."+t,function(){var a=$(".viewport");return a.hasClass("viewport-"+t)?(a.removeClass("viewport-sidebar"),void $.each(e,function(e,t){a.removeClass("viewport-"+t)})):($.each(e,function(e,t){a.removeClass("viewport-"+t)}),void a.addClass("viewport-sidebar").addClass("viewport-"+t))})}),location.hash){case"#help":$("a.help").click();break;case"#about":$("a.about").click();break;case"#account":$("a.account").click()}$(".template").css("background-color",Random.color()),$(".result").css("background-color",Random.color())}(),function(){function a(a){a=js_beautify(a),n.setValue(a)}function e(a){try{a=a.replace(/^([\r\n]*)/i,"").replace(/([\r\n]*$)/i,""),a=new Function("return "+a),a=a()}catch(e){a=e.toString()}var o;try{o=Mock.mock(a)||"",o=JSON.stringify(o,null,t)}catch(e){o=e.toString()}$("textarea[name=data]").val(o),c.setValue(o);var n=function(a){var e=encodeURIComponent(a).match(/%[89ABab]/g);return a.length+(e?e.length:0)}(o);n=(n/1024).toFixed(2),$("span.badge").text(n+" kB")}var t=4;$("div.header").on("click","a.save",function(a){n.getValue()&&$.ajax({url:"/mock/save",data:{tpl:n.getValue()},success:function(a){location.pathname="/"+a.id}})}).on("click","a.tidy",function(e){a(n.getValue())});var o=$("textarea[name=tpl]"),n=CodeMirror.fromTextArea(o.get(0),{tabSize:t,tabMode:"spaces",indentUnit:t,matchBrackets:!0,lineNumbers:!0,lineWrapping:!0,autofocus:!0,mode:"javascript",theme:"railscasts"});n.on("change",function(a){e(a.getValue())}),n.on("scroll",function(a){var e=n.getScrollInfo(),t=e.top/(e.height-e.clientHeight),o=c.getScrollInfo(),i=(o.height-o.clientHeight)*t;c.scrollTo(o.left,i)});var c=CodeMirror.fromTextArea($("textarea[name=data]").get(0),{lineNumbers:!0,autofocus:!1,mode:"javascript",theme:"railscasts"}),i=Mock.heredoc(function(){}),r=Mock.heredoc(function(){});$(".viewport .help").on("click","a.importSyntaxExample",function(a){n.setValue(i)}).on("click","a.importPlaceholderExample",function(a){n.setValue(r)}),n.setValue(i);var l="http://"+location.hostname+":1338";$.getJSON(l+"/mock/",function(a){for(var e="",t=a.data.length-1;t>=0;t--)e=e+'<li><a href="'+l+a.data[t].url+'">'+a.data[t].url+"</a> ["+a.data[t].name+"]</li>";$("#apiinserver").append(e)}),$("#confirm-upload").click(function(){var a=n.getValue(),e=$("#api_name").val(),t=$("#api_url").val();return""==e||""==t?void alert("还没有填全哦"):(t=t.replace("\\","/"),t.startsWith("/")||(t="/"+t),t.startsWith("/mock")?void alert("api地址不能以/mock开头"):void(confirm("确认上传您的Mock模板吗？\n(若存在同路径API，将覆盖源文件)")&&$.ajax({url:l+"/mock/",type:"POST",data:JSON.stringify({apiname:e,url:t,content:a})}).then(function(a){"sucess"==a.status?($("#i_ApiName").html(e),$("#i_url").html('接口地址： <a href="'+l+t+'">'+l+t+"</a>"),$("#noti").fadeIn()):alert("上传失败")}).fail(function(){alert("上传失败")})))})}();